<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testar Evolution API - Seu Servidor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .config {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .config-item {
            margin: 8px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .config-label {
            font-weight: bold;
            color: #667eea;
            display: inline-block;
            width: 150px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .instance-name {
            padding: 8px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 14px;
            width: 300px;
            margin-bottom: 10px;
        }
        .endpoint-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Testar Endpoints Evolution API</h1>
        <p class="subtitle">Teste seu servidor self-hosted para encontrar o endpoint correto</p>

        <div class="config">
            <div class="config-item">
                <span class="config-label">URL:</span>
                <span id="url">https://api.urbanautobot.com</span>
            </div>
            <div class="config-item">
                <span class="config-label">API Key:</span>
                <span>cfd9b746ea9e400dc8f4d3e8d57b0180</span>
            </div>
            <div class="config-item">
                <span class="config-label">Instance Name:</span>
                <input type="text" id="instanceName" class="instance-name" value="gerente_cec3f29d3904" placeholder="Nome da inst√¢ncia">
            </div>
        </div>

        <!-- TESTE 1: Listar Inst√¢ncias -->
        <div class="test-section">
            <h3>1Ô∏è‚É£ Listar Todas as Inst√¢ncias</h3>
            <p>Verifica todas as inst√¢ncias do servidor</p>
            <div class="endpoint-code">GET /instance/fetchInstances</div>
            <button onclick="testListInstances()">üîç Testar Listar Inst√¢ncias</button>
            <div id="result1"></div>
        </div>

        <!-- TESTE 2: Status da Inst√¢ncia -->
        <div class="test-section">
            <h3>2Ô∏è‚É£ Status da Inst√¢ncia</h3>
            <p>Verifica se a inst√¢ncia est√° conectada</p>
            <div class="endpoint-code">GET /instance/connectionState/:instanceName</div>
            <button onclick="testInstanceStatus()">üì± Testar Status</button>
            <div id="result2"></div>
        </div>

        <!-- TESTE 3: Buscar Mensagens - Endpoint 1 -->
        <div class="test-section">
            <h3>3Ô∏è‚É£ Buscar Mensagens - M√©todo 1</h3>
            <p>Tenta buscar mensagens pelo endpoint /message/fetch</p>
            <div class="endpoint-code">GET /message/fetch/:instanceName</div>
            <button onclick="testFetchMessages1()">üí¨ Testar Endpoint 1</button>
            <div id="result3"></div>
        </div>

        <!-- TESTE 4: Buscar Mensagens - Endpoint 2 -->
        <div class="test-section">
            <h3>4Ô∏è‚É£ Buscar Mensagens - M√©todo 2</h3>
            <p>Tenta buscar mensagens pelo endpoint /chat/findMessages</p>
            <div class="endpoint-code">POST /chat/findMessages/:instanceName</div>
            <button onclick="testFetchMessages2()">üí¨ Testar Endpoint 2</button>
            <div id="result4"></div>
        </div>

        <!-- TESTE 5: Webhook Config -->
        <div class="test-section">
            <h3>5Ô∏è‚É£ Configura√ß√£o de Webhook</h3>
            <p>Verifica como configurar webhook para receber mensagens</p>
            <div class="endpoint-code">POST /webhook/set/:instanceName</div>
            <button onclick="testWebhookConfig()">üîî Ver Webhook</button>
            <div id="result5"></div>
        </div>

        <!-- TESTE 6: Chats Dispon√≠veis -->
        <div class="test-section">
            <h3>6Ô∏è‚É£ Listar Chats</h3>
            <p>Lista todos os chats da inst√¢ncia</p>
            <div class="endpoint-code">GET /chat/findChats/:instanceName</div>
            <button onclick="testListChats()">üí¨ Listar Chats</button>
            <div id="result6"></div>
        </div>

        <!-- TESTE 7: Testar TUDO -->
        <div class="test-section" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%);">
            <h3>üöÄ TESTAR TODOS OS ENDPOINTS</h3>
            <p>Executa todos os testes de uma vez</p>
            <button onclick="testAll()" style="font-size: 18px; padding: 15px 30px;">üöÄ TESTAR TUDO</button>
            <div id="resultAll"></div>
        </div>
    </div>

    <script>
        const CONFIG = {
            url: 'https://api.urbanautobot.com',
            apiKey: 'cfd9b746ea9e400dc8f4d3e8d57b0180'
        };

        function getInstanceName() {
            return document.getElementById('instanceName').value || 'gerente_cec3f29d3904';
        }

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="result info"><div class="loading"></div>Testando...</div>';
        }

        function showResult(elementId, data, isError = false) {
            const resultDiv = document.getElementById(elementId);
            const className = isError ? 'error' : 'success';
            resultDiv.innerHTML = `<div class="result ${className}">${JSON.stringify(data, null, 2)}</div>`;
        }

        async function makeRequest(endpoint, method = 'GET', body = null) {
            const url = `${CONFIG.url}${endpoint}`;
            console.log(`üîç Testing: ${method} ${url}`);
            
            const options = {
                method: method,
                headers: {
                    'apikey': CONFIG.apiKey,
                    'Content-Type': 'application/json'
                }
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(url, options);
                const data = await response.json().catch(() => response.text());
                
                return {
                    status: response.status,
                    ok: response.ok,
                    statusText: response.statusText,
                    data: data
                };
            } catch (error) {
                return {
                    status: 0,
                    ok: false,
                    statusText: 'Network Error',
                    error: error.message
                };
            }
        }

        async function testListInstances() {
            showLoading('result1');
            const result = await makeRequest('/instance/fetchInstances');
            showResult('result1', result, !result.ok);
        }

        async function testInstanceStatus() {
            showLoading('result2');
            const instanceName = getInstanceName();
            const result = await makeRequest(`/instance/connectionState/${instanceName}`);
            showResult('result2', result, !result.ok);
        }

        async function testFetchMessages1() {
            showLoading('result3');
            const instanceName = getInstanceName();
            const result = await makeRequest(`/message/fetch/${instanceName}`);
            showResult('result3', result, !result.ok);
        }

        async function testFetchMessages2() {
            showLoading('result4');
            const instanceName = getInstanceName();
            const result = await makeRequest(`/chat/findMessages/${instanceName}`, 'POST', {
                where: {
                    key: {
                        fromMe: false
                    }
                },
                limit: 10
            });
            showResult('result4', result, !result.ok);
        }

        async function testWebhookConfig() {
            showLoading('result5');
            const instanceName = getInstanceName();
            const result = await makeRequest(`/webhook/find/${instanceName}`);
            showResult('result5', result, !result.ok);
        }

        async function testListChats() {
            showLoading('result6');
            const instanceName = getInstanceName();
            const result = await makeRequest(`/chat/findChats/${instanceName}`);
            showResult('result6', result, !result.ok);
        }

        async function testAll() {
            document.getElementById('resultAll').innerHTML = '<div class="result info"><div class="loading"></div>Executando todos os testes...</div>';
            
            await testListInstances();
            await new Promise(r => setTimeout(r, 500));
            
            await testInstanceStatus();
            await new Promise(r => setTimeout(r, 500));
            
            await testFetchMessages1();
            await new Promise(r => setTimeout(r, 500));
            
            await testFetchMessages2();
            await new Promise(r => setTimeout(r, 500));
            
            await testWebhookConfig();
            await new Promise(r => setTimeout(r, 500));
            
            await testListChats();
            
            document.getElementById('resultAll').innerHTML = '<div class="result success">‚úÖ Todos os testes conclu√≠dos! Verifique os resultados acima.</div>';
        }

        // Auto-test ao carregar
        console.log('üöÄ P√°gina carregada! Use os bot√µes para testar.');
        console.log('üìå Config:', CONFIG);
    </script>
</body>
</html>
